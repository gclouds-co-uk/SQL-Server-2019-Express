<!DOCTYPE html>
<html>
<head>
  <title>SQL Server 2019 Express on Windows Server 2019 Datacenter</title>
</head>
<body>
<h1 id="sql-server-2019-express-on-windows-server-2019-datacenter">SQL Server 2019 Express on Windows Server 2019 Datacenter</h1>

<h2 id="quick-start-guide">Quick Start Guide</h2>

<p>Welcome to SQL Server 2019 Express on Windows Server 2019 Datacenter! This guide will help you get started with your new SQL Server Express instance on Google Cloud Platform</p>

<h3 id="table-of-contents">Table of Contents</h3>
<ul>
  <li><a href="#sql-server-2019-express-on-windows-server-2019-datacenter">SQL Server 2019 Express on Windows Server 2019 Datacenter</a>
    <ul>
      <li><a href="#quick-start-guide">Quick Start Guide</a>
        <ul>
          <li><a href="#table-of-contents">Table of Contents</a></li>
          <li><a href="#introduction">Introduction</a>
            <ul>
              <li><a href="#key-features">Key Features</a></li>
              <li><a href="#sql-patch-level">SQL Patch Level</a></li>
            </ul>
          </li>
          <li><a href="#prerequisites">Prerequisites</a></li>
          <li><a href="#installation">Installation</a></li>
        </ul>
      </li>
      <li><a href="#before-you-get-started">Before You Get Started</a>
        <ul>
          <li><a href="#enabling-tcpip-protocol">Enabling TCP/IP Protocol</a>
            <ul>
              <li><a href="#to-set-a-tcpip-port-for-a-named-instance">To set a TCP/IP port for a named instance:</a></li>
            </ul>
          </li>
          <li><a href="#named-instance">Named Instance</a></li>
          <li><a href="#firewall">Firewall</a></li>
        </ul>
      </li>
      <li><a href="#connecting-to-sql-server-via-ssms">Connecting to SQL Server via SSMS</a></li>
      <li><a href="#connecting-to-sql-server-via-sqlcmd">Connecting to SQL Server via sqlcmd</a></li>
      <li><a href="#authentication">Authentication</a></li>
      <li><a href="#testing-the-installation">Testing the Installation</a></li>
    </ul>
  </li>
</ul>

<h3 id="introduction">Introduction</h3>

<p>This guide provides step-by-step instructions to quick start with SQL Server 2019 Express on Windows Server 2019 Datacenter at Google Cloud Platform.
You will have following within this bundle:</p>

<h4 id="key-features">Key Features</h4>
<table>
  <thead>
    <tr>
      <th>Feature</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>OS version</td>
      <td>Microsoft Windows Server 2019 Datacenter (10.0.17763)</td>
    </tr>
    <tr>
      <td>SQL Package</td>
      <td>Microsoft SQL Server 2019</td>
    </tr>
    <tr>
      <td>SQL Edition</td>
      <td>Express</td>
    </tr>
    <tr>
      <td>Type</td>
      <td>RTM-CU27 (KB5037331)</td>
    </tr>
    <tr>
      <td>Version</td>
      <td>15.0.2000.5</td>
    </tr>
    <tr>
      <td>Patch Level</td>
      <td>15.0.4375.4</td>
    </tr>
    <tr>
      <td>Features</td>
      <td>Database Engine Services, SQL Browser<br>SQL Writer, SQL Client Connectivity SDK</td>
    </tr>
    <tr>
      <td>Named Instance</td>
      <td>SQLEXPRESS</td>
    </tr>
    <tr>
      <td>Clustered</td>
      <td>No</td>
    </tr>
    <tr>
      <td>SSMS</td>
      <td>20.1</td>
    </tr>
  </tbody>
</table>

<h4 id="sql-patch-level">SQL Patch Level</h4>
<p>KB5037331 - Cumulative Update 27 for SQL Server 2019<br>
This update contains 13 <a href="https://learn.microsoft.com/en-us/troubleshoot/sql/releases/sqlserver-2019/cumulativeupdate27#improvements-and-fixes-included-in-this-update">fixes</a> 
that were issued after the release of SQL Server 2019 Cumulative Update 26, and it updates components in the following builds:</p>

<p>SQL Server - Product version: 15.0.4375.4, file version: 2019.150.4375.4</p>

<p><a href="https://learn.microsoft.com/en-us/troubleshoot/sql/releases/sqlserver-2019/cumulativeupdate27">Learn more</a></p>

<h3 id="prerequisites">Prerequisites</h3>
<ul>
  <li>A Google Cloud Platform account.</li>
  <li>Basic knowledge of SQL Server</li>
</ul>

<h3 id="installation">Installation</h3>

<ol>
    <li><strong>Deploy the Image</strong>: Follow the instructions on the <a href="https://console.cloud.google.com/marketplace/product/gclouds-public/sql-server-2019-express-on-windows-server-2019-datacenter?project=gclouds-public">Google Cloud Platform Marketplace</a> to deploy the SQL Server 2019 Express image.</li>
    <li><strong>Access the SQL Server as an Administrator</strong>: Once the deployment is complete, access your Windows Server instance using Remote Desktop Protocol (RDP) with an administrator user.
    <br> ***Create a Windows administrator user on the server by setting a password.***
    <div class="image-container"> <img src="images/GCP_Console_reset_password.png" alt="GCP Compute Engine Console" class="resized-image"></div>
    <div class="image-container"> <img src="images/Set_new_Windows_password.png" alt="Set a new Windows password" class="resized-image"></div></li>
  </ol>
  
  <style>
    .image-container {
      text-align: center; 
    }
  
    .resized-image {
      width: 50%; 
      height: auto;
      margin: 10px 0; /* Add some space between images */
    }
  </style>

<h2 id="before-you-get-started">Before You Get Started</h2>
<p>Before you can connect to your SQL Server instance from another machine, you will need to complete the following tasks:</p>
<ul>
  <li>Set default port TCP/IP protocol for the named SQL Server instance</li>
  <li>Create firewall rules for the required ports</li>
  <li>Create the necessary logins for SQL Server</li>
</ul>

<h3 id="enabling-tcpip-protocol">Enabling TCP/IP Protocol</h3>
<p>TCP/IP server network protocol is required to connect to this SQL Server instance from a remote machine. This requires enabling TCP/IP protocol for the SQL Server service. It has been already enabled on the deployed server.</p>

<h4 id="to-set-a-tcpip-port-for-a-named-instance">To set a TCP/IP port for a named instance:</h4>

<ol>
  <li>In SQL Server Configuration Manager, in the console pane, expand SQL Server Network Configuration.</li>
  <li>In the console pane, click Protocols for <code>SQLEXPRESS</code>.</li>
  <li>In the details pane, TCP/IP protocol properties, IP Addresses, IPAll TCP Port: <code>1433</code>
  <img src="embedded_images/TCPport-1433.png" alt="Set a TCP/IP port"></li>
  <li>In the console pane, click SQL Server Services.</li>
  <li>In the details pane, right-click SQL Server (<code>SQLEXPRESS</code>), and then click Restart, to stop and restart the SQL Server service.</li>
</ol>

<h3 id="named-instance">Named Instance</h3>
<p>A named instance of SQL Server ( <code><host name></code> \ <code>SQLEXPRESS</code>) uses dynamic ports.<br>
Because SQL Express is installed then you will need to create a firewall rule for UDP port 1434 as this is the port required by named instances of SQL Server Browser Service to locate the instance on the host.</p>

<h3 id="firewall">Firewall</h3>
<p>To access an instance of the SQL Server through a firewall, you must configure the firewall on the computer that is running SQL Server to allow access. The firewall is a component of Microsoft Windows. You can also install a firewall from another company.</p>

<p>You could use the <code>Powershell</code> to create the necessary exceptions to allow connections to the SQL Server instance.</p>

<p>An example of a command allowing the named instance TCP port of 1433 to be used is shown below.</p>

<pre><code>New-NetFirewallRule -DisplayName "SQLServer SQLEXPRESS named instance" -Direction Inbound -LocalPort 1433 -Protocol TCP -Action Allow
New-NetFirewallRule -DisplayName "SQLServer Browser service" -Direction Inbound -LocalPort 1434 -Protocol UDP -Action Allow
</code></pre>
<img src="embedded_images/Firewall_allowed_apps.png" alt="Firewall allowed apps SQL server">
<img src="embedded_images/Firewall_allowed_apps_sql_browser.png" alt="Firewall allowed apps SQL browser">

<h2 id="connecting-to-sql-server-via-ssms">Connecting to SQL Server via SSMS</h2>

<ol>
  <li><strong>Open SQL Server Management Studio (SSMS)</strong>: Launch SSMS on the server.
  <img src="embedded_images/SSMS_v20.1.png" alt="Launch SSMS"></li>
  <li><strong>Connect to the Server</strong>:
    <ul>
      <li><strong>Server Name</strong>: Use the IP address or the hostname of your Windows Server instance.</li>
      <li><strong>Authentication</strong>: Choose the Windows Authentication method
      <img src="embedded_images/SSMS_auth_admin_user.png" alt="SSMS Windows authentication"></li>
    </ul>
  </li>
  <li><strong>Verify the Connection</strong>: Ensure that you can connect to the <code>SQLEXPRESS</code> instance</li>
  <li><strong>Execute a sample SQL Query</strong>
  <pre><code>SELECT name FROM sys.databases WHERE database_id <= 4;
  GO
  </code></pre>
  <img src="embedded_images/SSMS_Query.png" alt="SSMS Sample Query"></li>
</ol>

<h2 id="connecting-to-sql-server-via-sqlcmd">Connecting to SQL Server via sqlcmd</h2>

<ol>
  <li><strong>Open a command prompt.</strong>: Launch cmd on the server</li>
  <li><strong>Change Directory.</strong>: C:\Program Files\Microsoft SQL Server\Client SDK\ODBC\170\Tools\Binn></li>
  <li><strong>Run sqlcmd prompt</strong>:Enter sqlcmd to start the SQL command-line tool.
  At the sqlcmd prompt (1>), type the following query and press Enter:
  <pre><code>SELECT name FROM sys.databases WHERE database_id <= 4;
  GO
  </code></pre>
  ***Output***
  <pre><code>name                                                                                                                    
  --------------------------------
  master                                                                                                                  
  tempdb                                                                                                                  
  model                                                                                                                   
  msdb                                                                                                                    

  (4 rows affected)
  </code></pre></li>
</ol>

<h2 id="authentication">Authentication</h2>
<p>As part of this packaged installation, the account running the SQL Server setup <code>BUILTIN\ADMINISTRATORS</code> has system administrator (sysadmin) privileges on the SQL Server. In case you need to add another Windows user as a system administrator, then this can be done using the following example.</p>

<pre><code>CREATE LOGIN [<domainName>\<loginName>] FROM WINDOWS;
GO
ALTER SERVER ROLE sysadmin ADD MEMBER [<domainName>\<loginName>];
GO
</code></pre>

<h2 id="testing-the-installation">Testing the Installation</h2>

<p>To verify that SQL Server is running correctly, you can perform the following tests:</p>

<ol>
  <li><strong>Check SQL Server Services</strong>: Ensure that the SQL Server is running. SQL Server Browser services is disabled.</li>
  <li><strong>Run a Simple Query</strong>: Open SSMS and run a sample query to test the connection and functionality:
   <pre><code>
     SELECT @@VERSION
     GO
   </code></pre></li>
</ol>

</body>
</html>